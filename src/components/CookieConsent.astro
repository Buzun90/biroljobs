---
---

<div id="cookie-consent" class="cookie-banner">
    <div class="cookie-content">
        <div class="cookie-text">
            <h3>Cookie Voorkeuren</h3>
            <p>
                Deze website gebruikt cookies om uw ervaring te verbeteren. Sommige cookies zijn noodzakelijk voor het functioneren van de website, 
                terwijl andere worden gebruikt voor analyse en marketing doeleinden. U kunt hieronder uw voorkeuren instellen.
            </p>
        </div>
        <div class="cookie-buttons">
            <button id="accept-all" class="cookie-button accept-all">Alles accepteren</button>
            <button id="accept-necessary" class="cookie-button accept-necessary">Alleen noodzakelijk</button>
            <button id="cookie-settings" class="cookie-button settings">Voorkeuren instellen</button>
        </div>
    </div>
</div>

<div id="cookie-settings-modal" class="cookie-modal">
    <div class="modal-content">
        <h3>Cookie Instellingen</h3>
        <div class="cookie-options">
            <div class="cookie-option">
                <label>
                    <input type="checkbox" id="necessary" checked disabled>
                    Noodzakelijke cookies
                </label>
                <p>Deze cookies zijn essentieel voor het functioneren van de website.</p>
            </div>
            <div class="cookie-option">
                <label>
                    <input type="checkbox" id="analytics">
                    Analytics cookies
                </label>
                <p>Helpen ons te begrijpen hoe bezoekers onze website gebruiken.</p>
            </div>
            <div class="cookie-option">
                <label>
                    <input type="checkbox" id="marketing">
                    Marketing cookies
                </label>
                <p>Worden gebruikt voor gepersonaliseerde advertenties en het delen van gegevens met advertentiepartners.</p>
            </div>
            <div class="cookie-option">
                <label>
                    <input type="checkbox" id="personalization">
                    Personalisatie cookies
                </label>
                <p>Maken het mogelijk om de website-ervaring aan te passen aan uw voorkeuren.</p>
            </div>
        </div>
        <div class="modal-buttons">
            <button id="save-preferences" class="cookie-button">Voorkeuren opslaan</button>
        </div>
    </div>
</div>

<style>
.cookie-banner {
    position: fixed;
    bottom: -100%;
    left: 0;
    width: 100%;
    background: #fff;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    padding: 20px;
    z-index: 1000;
    transition: bottom 0.3s ease-in-out;
}

.cookie-banner.show {
    bottom: 0;
}

.cookie-content {
    max-width: 1200px;
    margin: 0 auto;
}

.cookie-text {
    margin-bottom: 20px;
}

.cookie-text h3 {
    margin: 0 0 10px 0;
}

.cookie-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.cookie-button {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.2s;
}

.accept-all {
    background: #4CAF50;
    color: white;
}

.accept-necessary {
    background: #f0f0f0;
    color: #333;
}

.settings {
    background: #2196F3;
    color: white;
}

.cookie-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1001;
}

.cookie-modal.show {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 10px;
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}

.cookie-option {
    margin-bottom: 20px;
}

.cookie-option label {
    display: flex;
    align-items: center;
    font-weight: 500;
    margin-bottom: 5px;
}

.cookie-option input[type="checkbox"] {
    margin-right: 10px;
}

.cookie-option p {
    margin: 5px 0 0 25px;
    color: #666;
    font-size: 0.9em;
}

.modal-buttons {
    margin-top: 20px;
    text-align: right;
}

@media (max-width: 768px) {
    .cookie-buttons {
        flex-direction: column;
    }
    
    .cookie-button {
        width: 100%;
    }
}
</style>

<script is:inline>
class CookieConsent {
    constructor() {
        this.cookieName = 'cookie_consent';
        this.cookieExpiry = 365; // days
        this.initElements();
        this.initEventListeners();
        this.checkCookieConsent();
    }

    initElements() {
        this.banner = document.getElementById('cookie-consent');
        this.modal = document.getElementById('cookie-settings-modal');
        this.acceptAllBtn = document.getElementById('accept-all');
        this.acceptNecessaryBtn = document.getElementById('accept-necessary');
        this.settingsBtn = document.getElementById('cookie-settings');
        this.savePreferencesBtn = document.getElementById('save-preferences');
        this.analyticsCheckbox = document.getElementById('analytics');
        this.marketingCheckbox = document.getElementById('marketing');
        this.personalizationCheckbox = document.getElementById('personalization');
    }

    initEventListeners() {
        this.acceptAllBtn?.addEventListener('click', () => this.acceptAll());
        this.acceptNecessaryBtn?.addEventListener('click', () => this.acceptNecessary());
        this.settingsBtn?.addEventListener('click', () => this.openSettings());
        this.savePreferencesBtn?.addEventListener('click', () => this.savePreferences());
        
        // Close modal when clicking outside
        this.modal?.addEventListener('click', (e) => {
            if (e.target === this.modal) {
                this.closeSettings();
            }
        });
    }

    loadGoogleTag() {
        const gtagScript = document.createElement('script');
        gtagScript.async = true;
        gtagScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-GJPKZZDM1Y';
        document.head.appendChild(gtagScript);
    }

    updateConsentState(consent) {
        window.dataLayer = window.dataLayer || [];
        function gtag() { window.dataLayer.push(arguments); }

        gtag('consent', 'update', {
            'ad_user_data': consent.marketing ? 'granted' : 'denied',
            'ad_personalization': consent.personalization ? 'granted' : 'denied',
            'ad_storage': consent.marketing ? 'granted' : 'denied',
            'analytics_storage': consent.analytics ? 'granted' : 'denied'
        });

        if (consent.analytics || consent.marketing || consent.personalization) {
            this.loadGoogleTag();
        }
    }

    acceptAll() {
        const consent = {
            necessary: true,
            analytics: true,
            marketing: true,
            personalization: true,
            timestamp: new Date().toISOString()
        };
        this.saveConsent(consent);
    }

    acceptNecessary() {
        const consent = {
            necessary: true,
            analytics: false,
            marketing: false,
            personalization: false,
            timestamp: new Date().toISOString()
        };
        this.saveConsent(consent);
    }

    savePreferences() {
        const consent = {
            necessary: true,
            analytics: this.analyticsCheckbox?.checked || false,
            marketing: this.marketingCheckbox?.checked || false,
            personalization: this.personalizationCheckbox?.checked || false,
            timestamp: new Date().toISOString()
        };
        this.saveConsent(consent);
        this.closeSettings();
    }

    saveConsent(consent) {
        localStorage.setItem('consentGranted', JSON.stringify(consent));
        this.setCookie(this.cookieName, JSON.stringify(consent), this.cookieExpiry);
        this.updateConsentState(consent);
        this.hideBanner();
    }

    setCookie(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        const expires = "; expires=" + date.toUTCString();
        document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
    }

    getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let c of ca) {
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    showBanner() {
        this.banner?.classList.add('show');
    }

    hideBanner() {
        this.banner?.classList.remove('show');
    }

    openSettings() {
        this.modal?.classList.add('show');
    }

    closeSettings() {
        this.modal?.classList.remove('show');
    }

    checkCookieConsent() {
        const consent = this.getCookie(this.cookieName);
        if (!consent) {
            this.showBanner();
        } else {
            const parsedConsent = JSON.parse(consent);
            this.updateConsentState(parsedConsent);
        }
    }
}

// Initialize cookie consent when the DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    new CookieConsent();
});
</script>
